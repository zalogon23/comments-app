(this["webpackJsonpcomments-app"]=this["webpackJsonpcomments-app"]||[]).push([[0],{34:function(e,t,c){},41:function(e,t,c){"use strict";c.r(t);var n=c(1),a=c(26),s=c.n(a),o=(c(34),c(9)),r=c(4),i=c(5),l=c(6),j=c(27),u=c(0),d=Object(n.createContext)();var m=function(e){var t,c=e.children,a=!1,s=Object(j.a)(document.cookie.split(";"));try{for(s.s();!(t=s.n()).done;){0===t.value.indexOf("connect.sid")&&(a=!0)}}catch(h){s.e(h)}finally{s.f()}var o=Object(n.useState)({logged:a}),i=Object(r.a)(o,2),m=i[0],b=i[1];return Object(n.useEffect)((function(){m.logged&&fetch("/api/profile").then((function(e){return e.json()})).then((function(e){return b(Object(l.a)({logged:!0},e.data))})).catch((function(e){e&&console.log(e)}))}),[]),Object(u.jsx)(d.Provider,{value:[m,b],children:c})};var b=function(){var e=Object(n.useContext)(d),t=Object(r.a)(e,2),c=t[0],a=t[1],s=Object(i.h)().pathname;return Object(u.jsxs)("header",{className:"main-header",children:[0!==s.indexOf("/login")&&(c.logged?Object(u.jsx)("button",{onClick:function(){fetch("/api/logout",{method:"POST"}).then((function(e){return e.json()})).then((function(e){a({logged:!1}),console.log(e),J.removeQueries()})).catch((function(e){e&&console.log(e)}))},className:"logout",children:"Log Out"}):Object(u.jsx)(o.b,{to:"/login",className:"login",children:"Log In"})),Object(u.jsx)("h1",{className:"title",children:"COMMENTS APP"}),Object(u.jsxs)("div",{className:"comment",children:[Object(u.jsx)("input",{type:"text",placeholder:"Look for a topic..."}),Object(u.jsx)("button",{className:"add add-main",children:Object(u.jsx)("i",{className:"fas fa-search"})})]}),Object(u.jsx)("nav",{children:Object(u.jsxs)("ul",{children:[Object(u.jsx)(o.c,{activeClassName:"here",exact:!0,to:"/",children:"Home"}),Object(u.jsx)(o.c,{activeClassName:"here",to:"/profile",children:"Profile"}),Object(u.jsx)(o.c,{activeClassName:"here",to:"/topics",children:"Topics"}),Object(u.jsx)(o.c,{activeClassName:"here",to:"/enemies",children:"Enemies"})]})})]})};var h=function(){return Object(u.jsx)(u.Fragment,{children:Object(u.jsx)("main",{className:"home",children:Object(u.jsxs)("div",{className:"content",children:[Object(u.jsx)("h2",{className:"title",children:"Prepare to discuss"}),Object(u.jsx)("p",{className:"intro",children:"Este sitio fue ideado con la premisa de que a todos les gusta hablar mal de algo. Y debido a lo comun que es, he considerado necesario declararlo como un Derecho Humano, el derecho de quejarse de todo. Por lo anterior, esta plataforma simplemente se presenta como un medio de descarga emocional, y... por que no (en el mejor de los casos) como punto de discusiones constructivas y tertulias amenas."}),Object(u.jsxs)("div",{className:"random",children:[Object(u.jsx)("span",{children:"Random Discussion"}),Object(u.jsx)("button",{className:"go-to-comments",children:"Join"})]})]})})})};var O=function(e,t){e.id||fetch("api/profile",{method:"GET"}).then((function(e){return e.json()})).then((function(e){console.log(e),e.error||e.id+100&&t.replace("/")}))};var f=function(){var e=Object(n.useContext)(d),t=Object(r.a)(e,2),c=t[0],a=t[1],s=Object(n.useState)(""),j=Object(r.a)(s,2),m=j[0],b=j[1],h=Object(n.useState)(""),f=Object(r.a)(h,2),p=f[0],g=f[1],x=Object(n.useState)(""),v=Object(r.a)(x,2),N=v[0],C=v[1],y=(Object(i.h)().state||{from:{pathname:"/"}}).from,S=Object(i.g)();return Object(n.useEffect)((function(){O(c,S)}),[]),Object(u.jsxs)("main",{className:"login-form",children:[Object(u.jsx)("h3",{className:"title",children:"Login"}),Object(u.jsxs)("form",{children:[Object(u.jsx)("input",{onChange:function(e){return b(e.target.value)},value:m,type:"text",className:"username ".concat("username"===N&&"error-primary"),placeholder:"Username"}),Object(u.jsx)("input",{onChange:function(e){return g(e.target.value)},value:p,type:"password",className:"password ".concat("password"===N&&"error-primary"),placeholder:"Password"}),Object(u.jsx)("button",{onClick:function(e){e.preventDefault(),fetch("api/login",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({username:m,password:p})}).then((function(e){return e.json()})).then((function(e){if(!e.error)return a(Object(l.a)(Object(l.a)({},e.data),{},{logged:!0})),console.log(e),void S.replace(y);"username"===e.cause&&C("username"),"password"===e.cause&&C("password")})).catch((function(e){e&&console.log(e)}))},className:"login",children:"Login"})]}),Object(u.jsxs)("div",{className:"register-now",children:[Object(u.jsx)("span",{children:" Have not an account yet? "}),Object(u.jsx)(o.b,{to:"/register",children:"Sign In"})]})]})},p=c(44);function g(){document.querySelector(".image-picker-input").click()}var x=function(e){var t=e.user,c=e.setUser,a=Object(n.useState)(!1),s=Object(r.a)(a,2),o=s[0],i=s[1],j=Object(n.useRef)();return Object(u.jsxs)("form",{className:"avatar-section",children:[Object(u.jsx)("img",{ref:j,onClick:g,className:"image-picker",src:t.profile_image,alt:"Profile"}),o&&Object(u.jsxs)("div",{className:"image-actions",children:[Object(u.jsx)("button",{className:"confirmUpdateImage",onClick:function(e){e.preventDefault();var n=new FormData(document.forms[0]);fetch("/api/profile/avatar",{method:"PUT",body:n}).then((function(e){return e.json()})).then((function(e){c(Object(l.a)(Object(l.a)({},t),{},{profile_image:e.path})),J.removeQueries()})).catch((function(e){return console.log(e)})).finally((function(){return i(!1)}))},children:Object(u.jsx)("i",{className:"fas fa-check yes"})}),Object(u.jsx)("button",{className:"cancelUpdateImage",onClick:function(){i(!1),j.current.src=t.profile_image,document.querySelector(".image-picker-input")&&(document.querySelector(".image-picker-input").value="")},children:Object(u.jsx)("i",{className:"fas fa-times"})})]}),Object(u.jsx)("i",{className:"fas fa-camera change-image"}),Object(u.jsx)("input",{name:"avatar",onChange:function(e){e.target.files[0]&&function(e,t){var c=e.target.files[0];if("image/svg+xml"!==c.type){var n=new Blob([c]),a=URL.createObjectURL(n);t.src=a}}(e,j.current);i(!0),void 0===e.target.files[0]&&(j.current.src=t.profile_image,i(!1))},className:"image-picker-input",accept:"image/*",type:"file"})]})};var v=function(e){var t=e.user,c=e.setUser,a=Object(n.useState)(!1),s=Object(r.a)(a,2),o=s[0],i=s[1],j=Object(n.useState)(""),d=Object(r.a)(j,2),m=d[0],b=d[1];return Object(u.jsx)("div",{className:"info",children:o?Object(u.jsxs)(u.Fragment,{children:[Object(u.jsx)("textarea",{onChange:function(e){return b(e.target.value)},className:"set-personal-info",value:m}),Object(u.jsxs)("div",{className:"actions",children:[Object(u.jsx)("button",{onClick:function(){fetch("/api/profile/info",{method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({info:m})}).then((function(e){return e.json()})).then((function(e){c(Object(l.a)(Object(l.a)({},t),{},{profile_info:e.data})),h(),J.removeQueries()})).catch((function(e){e&&console.log(e)}))},className:"set",children:"Set"}),Object(u.jsx)("button",{onClick:h,className:"cancel",children:"Cancel"})]})]}):Object(u.jsxs)(u.Fragment,{children:[Object(u.jsx)("p",{children:t.profile_info}),Object(u.jsx)("button",{onClick:function(){i(!0),b(t.profile_info)},className:"edit",children:"Edit"})]})});function h(){i(!1)}};var N=function(){var e=Object(n.useContext)(d),t=Object(r.a)(e,2),c=t[0],a=t[1],s=Object(p.a)("userdata",(function(){return fetch("/api/profile").then((function(e){return e.json()}))}));return Object(n.useEffect)((function(){s.isSuccess&&a(Object(l.a)(Object(l.a)({},c),s.data.data))}),[]),Object(u.jsx)("main",{className:"profile",children:s.isLoading?Object(u.jsx)("div",{className:"loading",children:"It is loading..."}):s.isError?Object(u.jsx)("div",{className:"error",children:"There was an error fetching. Please log out and try again"}):Object(u.jsxs)(u.Fragment,{children:[Object(u.jsx)(x,{user:c,setUser:a}),Object(u.jsxs)("div",{className:"content",children:[Object(u.jsx)("h3",{className:"name",children:c.username}),Object(u.jsx)(v,{user:c,setUser:a})]})]})})};var C=function(){var e=Object(i.g)(),t=Object(n.useContext)(d),c=Object(r.a)(t,1)[0],a=Object(n.useState)(""),s=Object(r.a)(a,2),o=s[0],l=s[1],j=Object(n.useState)(""),m=Object(r.a)(j,2),b=m[0],h=m[1],f=Object(n.useState)(""),p=Object(r.a)(f,2),g=p[0],x=p[1];return Object(n.useEffect)((function(){O(c,e)}),[]),Object(u.jsxs)("main",{className:"register-form",children:[Object(u.jsx)("h3",{className:"title",children:"Register"}),Object(u.jsxs)("form",{children:[Object(u.jsx)("input",{onChange:function(e){return h(e.target.value)},type:"text",className:"username ".concat("username"===o&&"error-primary"),placeholder:"Username",value:b}),Object(u.jsx)("input",{onChange:function(e){return x(e.target.value)},type:"password",className:"password ".concat("password"===o&&"error-primary"),placeholder:"Password",value:g}),Object(u.jsx)("button",{onClick:function(t){t.preventDefault(),fetch("api/register",{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",body:JSON.stringify({username:b,password:g})}).then((function(e){return e.json()})).then((function(t){console.log(t),t.error?("username"===t.cause&&l("username"),"password"===t.cause&&l("password")):e.replace("/login")})).catch((function(e){console.log(e),e&&console.log("No se pudo enviar la data...")}))},className:"register",children:"Register"})]})]})},y=c(19);var S=function e(t){var c=t.source,a=Object(n.useState)(!1),s=Object(r.a)(a,2),j=s[0],m=s[1],b=Object(n.useState)(!1),h=Object(r.a)(b,2),O=h[0],f=h[1],p=Object(n.useState)(""),g=Object(r.a)(p,2),x=g[0],v=g[1],N=Object(n.useContext)(d),C=Object(r.a)(N,1)[0],S=Object(n.useState)(JSON.parse(c.children)),k=Object(r.a)(S,2),w=k[0],T=k[1],E=c.commenting,P=c.setCommenting,A=Object(i.g)(),L=Object(n.useRef)();return Object(n.useEffect)((function(){document.activeElement.blur(),L.current&&L.current.focus()}),[j]),Object(u.jsxs)("article",{className:"comment ".concat(c.id),children:[Object(u.jsx)(o.b,{className:"author",to:c.author===C.id?"/profile":"/users/".concat(c.author),children:c.authorName}),Object(u.jsx)("p",{className:"content",children:c.content}),Object(u.jsxs)("ul",{className:"actions",children:[j?Object(u.jsxs)(u.Fragment,{children:[Object(u.jsx)("input",{ref:L,value:x,onChange:function(e){return v(e.target.value)},type:"text",className:"answer-comment"}),Object(u.jsx)("button",{onClick:function(e){m(!1),P(!1),v(""),fetch("/api/comment/",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({topic:c.topic,content:x,parent:c.id})}).then((function(e){return e.json()})).then((function(e){T([].concat(Object(y.a)(w),[e.data])),O||U()})).catch((function(e){e&&console.log(e)}))},className:"send-answer-comment",children:"Send"}),Object(u.jsx)("button",{onClick:function(){m(!1),P(!1)},className:"abort-answer-comment",children:"\xd7"})]}):Object(u.jsxs)(u.Fragment,{children:[!!w.length&&Object(u.jsx)("button",{onClick:U,className:"see-more",children:"..."}),Object(u.jsx)("button",{onClick:function(){E||(C.logged||A.push("/login"),m(!0),P(!0))},className:"answer",children:"+"})]}),C.id===c.author&&Object(u.jsx)("button",{onClick:function(e){return t=c.id,c.setChildComments(c.childComments.filter((function(e){return e.id!==t}))),void fetch("/api/comment",{method:"DELETE",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({id:t})}).then((function(e){return e.json()})).then((function(e){return console.log(e)})).catch((function(e){e&&console.log(e)})).finally((function(){document.querySelector(".answer-comment")||P(!1)}));var t},className:"delete",children:Object(u.jsx)("i",{className:"fa fa-trash","aria-hidden":"true"})})]}),Object(u.jsx)("ol",{className:"children",children:!!w.length&&O&&w.map((function(t){return Object(u.jsx)(e,{source:Object(l.a)(Object(l.a)({},t),{},{childComments:w,setChildComments:T,commenting:E,setCommenting:P})},t.id+1e9)}))})]});function U(){!1!==O?f(!1):fetch("/api/comment/".concat(c.id)).then((function(e){return e.json()})).then((function(e){return T(e)})).catch((function(e){return console.log(e)})).finally((function(){return f(!0)}))}};var k=function(){var e=Object(i.h)().pathname,t=Object(n.useContext)(d),c=Object(r.a)(t,1)[0],a=Object(n.useState)(""),s=Object(r.a)(a,2),o=s[0],j=s[1],m=Object(n.useState)(""),b=Object(r.a)(m,2),h=b[0],O=b[1],f=Object(i.g)(),p=Object(n.useState)([]),g=Object(r.a)(p,2),x=g[0],v=g[1],N=Object(n.useState)(!1),C=Object(r.a)(N,2),k=C[0],w=C[1],T=Object(n.useState)(""),E=Object(r.a)(T,2),P=E[0],A=E[1];return Object(n.useEffect)((function(){console.log("/api"+e),fetch("/api"+e).then((function(e){return e.json()})).then((function(e){var t=e.topic,c=e.comments;O(t),v(c),console.log(t)})).catch((function(e){e&&console.log(e)}))}),[]),Object(u.jsxs)(u.Fragment,{children:[Object(u.jsxs)("main",{className:"topic",children:[Object(u.jsx)("h3",{className:"title",children:null===h||void 0===h?void 0:h.subject}),Object(u.jsx)("p",{className:"intro",children:null===h||void 0===h?void 0:h.intro})]}),Object(u.jsxs)("article",{className:"actions",children:[Object(u.jsx)("input",{type:"text",className:"comment-content ".concat("main"===o&&"error-primary"),onChange:function(e){return A(e.target.value)},value:P}),Object(u.jsx)("button",{className:"add-comment",onClick:function(){c.logged||f.push("/login");if(!P.length)return void j("main");j(""),fetch("/api/comment",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({topic:h.id,parent:null,content:P})}).then((function(e){return e.json()})).then((function(e){A(""),v([].concat(Object(y.a)(x),[Object(l.a)(Object(l.a)({},e.data),{},{authorName:c.username})]))})).catch((function(e){return console.log(e)}))},children:"+"})]}),Object(u.jsx)("section",{className:"comments",children:x.map((function(e){return Object(u.jsx)(S,{source:Object(l.a)(Object(l.a)({},e),{},{childComments:x,setChildComments:v,commenting:k,setCommenting:w})},e.id+1e7)}))})]})};var w=function(){var e=Object(n.useState)(""),t=Object(r.a)(e,2),c=t[0],a=t[1],s=Object(n.useState)(""),o=Object(r.a)(s,2),i=o[0],j=o[1];return Object(u.jsxs)("main",{className:"create-topic",children:[Object(u.jsx)("h3",{className:"title",children:"What topic would you like to create?"}),Object(u.jsxs)("form",{className:"topic-info",children:[Object(u.jsx)("input",{placeholder:"Topic's title",type:"text",className:"subject",value:c,onChange:function(e){return a(e.target.value)}}),Object(u.jsx)("textarea",{placeholder:"A small introduction...",className:"intro",value:i,onChange:function(e){return j(e.target.value)}}),Object(u.jsx)("button",{className:"create",onClick:function(e){if(e.preventDefault(),!c.length||!i.length)return;var t=d(c),n=d(i),s={subject:t,intro:n};fetch("/api/topics",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(Object(l.a)({},s))}).then((function(e){return e.json()})).then((function(e){console.log(e),j(""),a("")})).catch((function(e){return console.log(e)}))},children:"Create!"})]})]});function d(e){return e.charAt(0).toUpperCase()+e.slice(1)}};var T=function(){var e=Object(n.useContext)(d),t=Object(r.a)(e,1)[0],c=Object(p.a)("topics",(function(){return fetch("/api/topics").then((function(e){return e.json()}))}));console.log(c);var a=Object(i.i)().path;return Object(u.jsxs)(i.d,{children:[Object(u.jsx)(i.b,{exact:!0,path:a,children:c.isLoading?Object(u.jsx)("div",{children:" Loading... "}):c.isError?Object(u.jsx)("div",{children:" There was an error, please refresh "}):Object(u.jsxs)(u.Fragment,{children:[t.logged&&Object(u.jsx)("section",{className:"create-topic",children:Object(u.jsx)(o.b,{to:"".concat(a,"/create"),className:"add-topic",children:"Add a new topic!"})}),Object(u.jsx)("main",{className:"topics",children:c.data.data.map((function(e){return Object(u.jsxs)("article",{className:"topic ".concat(e.id),children:[Object(u.jsxs)(o.b,{to:"".concat(a,"/").concat(e.id),children:[Object(u.jsx)("div",{className:"rating",children:[1,2,3,4,5].map((function(t){return t<=e.rating?Object(u.jsx)("i",{className:"fas fa-star"},t):Object(u.jsx)("i",{className:"far fa-star"},t+100)}))}),Object(u.jsx)("h3",{className:"title",children:e.subject}),Object(u.jsx)("p",{className:"content",children:e.intro}),Object(u.jsx)("h4",{className:"founder",children:e.authorName})]}),e.author===t.id&&Object(u.jsx)("button",{onClick:function(){return t=e.id,void fetch("/api/topics",{method:"DELETE",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({id:t})}).then((function(e){return e.json()})).then((function(e){console.log(e),J.invalidateQueries("topics")})).catch((function(e){return console.log(e)}));var t},className:"delete",children:Object(u.jsx)("i",{className:"fa fa-trash","aria-hidden":"true"})})]},e.id)}))})]})}),Object(u.jsx)(i.b,{path:"".concat(a,"/create"),component:w}),Object(u.jsx)(i.b,{exact:!0,path:"".concat(a,"/:id"),component:k})]})};var E=function(){var e=Object(i.i)().params.id,t=Object(p.a)("anotheruser",(function(){return fetch("/api/users/"+e).then((function(e){return e.json()}))}),{cacheTime:0});return Object(u.jsx)("main",{className:"profile user",children:t.isLoading?Object(u.jsx)("div",{className:"loading",children:"It is loading..."}):t.isError?Object(u.jsx)("div",{className:"error",children:"There was an error fetching. Please log out and try again"}):Object(u.jsxs)(u.Fragment,{children:[Object(u.jsx)("div",{className:"avatar-section",children:Object(u.jsx)("img",{className:"image-picker",src:"/"+t.data.data.profile_image,alt:"Profile"})}),Object(u.jsxs)("div",{className:"content",children:[Object(u.jsx)("h3",{className:"name",children:t.data.data.username}),Object(u.jsx)("p",{children:t.data.data.profile_info})]})]})})};var P=function(e){var t=Object(n.useContext)(d),c=Object(r.a)(t,1)[0].logged,a=Object(i.h)();return Object(u.jsx)(u.Fragment,{children:c?Object(u.jsx)(i.b,Object(l.a)({},e)):Object(u.jsx)(i.a,{to:{pathname:"/login",state:{from:a}}})})};var A=function(e){var t=Object(n.useContext)(d),c=Object(r.a)(t,1)[0];console.log(c.logged?"Already logged":"Isnt logged yet");var a=c.logged;return Object(u.jsx)(u.Fragment,{children:a?Object(u.jsx)(i.a,{to:{pathname:"/"}}):Object(u.jsx)(i.b,Object(l.a)({},e))})};var L=function(){return Object(u.jsxs)(i.d,{children:[Object(u.jsx)(i.b,{exact:!0,path:"/",component:h}),Object(u.jsx)(A,{path:"/login",component:f}),Object(u.jsx)(A,{path:"/register",component:C}),Object(u.jsx)(P,{path:"/profile",component:N}),Object(u.jsx)(i.b,{path:"/topics",component:T}),Object(u.jsx)(i.b,{path:"/users/:id",component:E})]})},U=c(43),F=c(29),J=new U.a;var D=function(){return Object(u.jsx)(F.a,{client:J,children:Object(u.jsx)(m,{children:Object(u.jsxs)(o.a,{children:[Object(u.jsx)(b,{}),Object(u.jsx)(L,{})]})})})};s.a.render(Object(u.jsx)(D,{}),document.getElementById("root"))}},[[41,1,2]]]);
//# sourceMappingURL=main.771eb646.chunk.js.map