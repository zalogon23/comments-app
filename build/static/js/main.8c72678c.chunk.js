(this["webpackJsonpcomments-app"]=this["webpackJsonpcomments-app"]||[]).push([[0],{34:function(e,t,n){},41:function(e,t,n){"use strict";n.r(t);var c=n(1),a=n(26),s=n.n(a),o=(n(34),n(6)),r=n(2),i=n(5),l=n(7),j=n(27),u=n(0),d=Object(c.createContext)();var b=function(e){var t,n=e.children,a=!1,s=Object(j.a)(document.cookie.split(";"));try{for(s.s();!(t=s.n()).done;){0===t.value.indexOf("connect.sid")&&(a=!0)}}catch(m){s.e(m)}finally{s.f()}var o=Object(c.useState)({logged:a}),i=Object(r.a)(o,2),b=i[0],h=i[1];return Object(c.useEffect)((function(){b.logged&&fetch("/api/profile").then((function(e){return e.json()})).then((function(e){return h(Object(l.a)({logged:!0},e.data))})).catch((function(e){e&&console.log(e)}))}),[]),Object(u.jsx)(d.Provider,{value:[b,h],children:n})},h=Object(c.createContext)();var m=function(e){var t=e.children,n=Object(i.h)().pathname,a=Object(c.useState)(""),s=Object(r.a)(a,2),o=s[0],l=s[1];return""===o&&0===n.indexOf("/topics/search/")&&l(n.slice(15)),Object(u.jsx)(h.Provider,{value:[o,l],children:t})};var O=function(e){var t=e.placeholder,n=e.className,a=Object(c.useState)(""),s=Object(r.a)(a,2),o=s[0],l=s[1],j=Object(c.useContext)(h),d=Object(r.a)(j,2),b=(d[0],d[1]),m=Object(i.g)();return Object(u.jsxs)("form",{children:[Object(u.jsx)("input",{value:o,onChange:function(e){return l(e.target.value)},type:"text",placeholder:t}),Object(u.jsx)("button",{onClick:function(e){if(e.preventDefault(),!o.length)return;m.push("/topics/search/"+o),b(o),l("")},className:n,children:Object(u.jsx)("i",{className:"fas fa-search"})})]})};var f=function(){var e=Object(c.useContext)(d),t=Object(r.a)(e,2),n=t[0],a=t[1],s=Object(i.h)().pathname,l=Object(i.g)();return Object(u.jsxs)("header",{className:"main-header",children:[0!==s.indexOf("/login")&&(n.logged?Object(u.jsx)("button",{onClick:function(){fetch("/api/logout",{method:"POST"}).then((function(e){return e.json()})).then((function(e){a({logged:!1}),console.log(e),K.removeQueries(),l.push("/")})).catch((function(e){e&&console.log(e)}))},className:"logout",children:"Log Out"}):Object(u.jsx)(o.b,{to:"/login",className:"login",children:"Log In"})),Object(u.jsx)("h1",{className:"title",children:"COMMENTS APP"}),Object(u.jsx)("div",{className:"comment",children:Object(u.jsx)(O,{className:"add add-main",placeholder:"Look for a topic!"})}),Object(u.jsx)("nav",{children:Object(u.jsxs)("ul",{children:[Object(u.jsx)(o.c,{activeClassName:"here",exact:!0,to:"/",children:"Home"}),Object(u.jsx)(o.c,{activeClassName:"here",to:"/profile",children:"Profile"}),Object(u.jsx)(o.c,{activeClassName:"here",to:"/topics",children:"Topics"}),Object(u.jsx)(o.c,{activeClassName:"here",to:"/enemies",children:"Enemies"})]})})]})};var p=function(){return Object(u.jsx)(u.Fragment,{children:Object(u.jsx)("main",{className:"home",children:Object(u.jsxs)("div",{className:"content",children:[Object(u.jsx)("h2",{className:"title",children:"Prepare to discuss"}),Object(u.jsx)("p",{className:"intro",children:"Este sitio fue ideado con la premisa de que a todos les gusta hablar mal de algo. Y debido a lo comun que es, he considerado necesario declararlo como un Derecho Humano, el derecho de quejarse de todo. Por lo anterior, esta plataforma simplemente se presenta como un medio de descarga emocional, y... por que no (en el mejor de los casos) como punto de discusiones constructivas y tertulias amenas."}),Object(u.jsxs)("div",{className:"random",children:[Object(u.jsx)("span",{children:"Random Discussion"}),Object(u.jsx)("button",{className:"go-to-comments",children:"Join"})]})]})})})};var x=function(e,t){e.id||fetch("api/profile",{method:"GET"}).then((function(e){return e.json()})).then((function(e){console.log(e),e.error||e.id+100&&t.replace("/")}))};var g=function(){var e=Object(c.useContext)(d),t=Object(r.a)(e,2),n=t[0],a=t[1],s=Object(c.useState)(""),j=Object(r.a)(s,2),b=j[0],h=j[1],m=Object(c.useState)(""),O=Object(r.a)(m,2),f=O[0],p=O[1],g=Object(c.useState)(""),N=Object(r.a)(g,2),v=N[0],C=N[1],y=(Object(i.h)().state||{from:{pathname:"/"}}).from,S=Object(i.g)();return Object(c.useEffect)((function(){x(n,S)}),[]),Object(u.jsxs)("main",{className:"login-form",children:[Object(u.jsx)("h3",{className:"title",children:"Login"}),Object(u.jsxs)("form",{children:[Object(u.jsx)("input",{onChange:function(e){return h(e.target.value)},value:b,type:"text",className:"username ".concat("username"===v&&"error-primary"),placeholder:"Username"}),Object(u.jsx)("input",{onChange:function(e){return p(e.target.value)},value:f,type:"password",className:"password ".concat("password"===v&&"error-primary"),placeholder:"Password"}),Object(u.jsx)("button",{onClick:function(e){e.preventDefault(),fetch("api/login",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({username:b,password:f})}).then((function(e){return e.json()})).then((function(e){if(!e.error)return a(Object(l.a)(Object(l.a)({},e.data),{},{logged:!0})),console.log(e),void S.replace(y);"username"===e.cause&&C("username"),"password"===e.cause&&C("password")})).catch((function(e){e&&console.log(e)}))},className:"login",children:"Login"})]}),Object(u.jsxs)("div",{className:"register-now",children:[Object(u.jsx)("span",{children:" Have not an account yet? "}),Object(u.jsx)(o.b,{to:"/register",children:"Sign In"})]}),Object(u.jsxs)("div",{className:"reset",children:[Object(u.jsx)("span",{children:" Forgot your password "}),Object(u.jsx)(o.b,{to:"/reset",children:"Reset"})]})]})},N=n(44);function v(){document.querySelector(".image-picker-input").click()}var C=function(e){var t=e.user,n=e.setUser,a=Object(c.useState)(!1),s=Object(r.a)(a,2),o=s[0],i=s[1],j=Object(c.useRef)(),d=Object(c.useState)(!1),b=Object(r.a)(d,2),h=b[0],m=b[1],O=Object(c.useRef)();return Object(u.jsx)(u.Fragment,{children:Object(u.jsxs)("form",{ref:O,children:[Object(u.jsxs)("div",{className:"avatar-section",children:[Object(u.jsx)("img",{ref:j,onClick:v,className:"image-picker",src:t.profile_image,alt:"Profile"}),Object(u.jsx)("i",{className:"fas fa-camera change-image"}),Object(u.jsx)("input",{name:"avatar",onChange:function(e){e.target.files[0]&&function(e,t){var n=e.target.files[0];if("image/svg+xml"!==n.type){var c=new Blob([n]),a=URL.createObjectURL(c);t.src=a}}(e,j.current);i(!0),void 0===e.target.files[0]&&(j.current.src=t.profile_image,i(!1))},className:"image-picker-input",accept:"image/*",type:"file"}),h&&Object(u.jsx)("p",{className:"loading",children:"The image is uploading"})]}),o&&Object(u.jsxs)("div",{className:"image-actions",children:[Object(u.jsx)("button",{className:"confirmUpdateImage",onClick:function(e){e.preventDefault();var c=new FormData(O.current);console.log(document.forms[1]),m(!0),fetch("/api/profile/avatar",{method:"PUT",body:c}).then((function(e){return e.json()})).then((function(e){n(Object(l.a)(Object(l.a)({},t),{},{profile_image:e.path})),K.refetchQueries("userdata")})).catch((function(e){return alert(e)})).finally((function(){i(!1),m(!1)}))},children:Object(u.jsx)("i",{className:"fas fa-check yes"})}),Object(u.jsx)("button",{className:"cancelUpdateImage",onClick:function(){i(!1),j.current.src=t.profile_image,document.querySelector(".image-picker-input")&&(document.querySelector(".image-picker-input").value="")},children:Object(u.jsx)("i",{className:"fas fa-times"})})]})]})})};var y=function(e){var t=e.user,n=e.setUser,a=Object(c.useState)(!1),s=Object(r.a)(a,2),o=s[0],i=s[1],j=Object(c.useState)(""),d=Object(r.a)(j,2),b=d[0],h=d[1];return Object(u.jsx)("div",{className:"info",children:o?Object(u.jsxs)(u.Fragment,{children:[Object(u.jsx)("textarea",{onChange:function(e){return h(e.target.value)},className:"set-personal-info",value:b}),Object(u.jsxs)("div",{className:"actions",children:[Object(u.jsx)("button",{onClick:function(){fetch("/api/profile/info",{method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({info:b})}).then((function(e){return e.json()})).then((function(e){n(Object(l.a)(Object(l.a)({},t),{},{profile_info:e.data})),m(),K.removeQueries()})).catch((function(e){e&&console.log(e)}))},className:"set",children:"Set"}),Object(u.jsx)("button",{onClick:m,className:"cancel",children:"Cancel"})]})]}):Object(u.jsxs)(u.Fragment,{children:[Object(u.jsx)("p",{children:t.profile_info}),Object(u.jsx)("button",{onClick:function(){i(!0),h(t.profile_info)},className:"edit",children:"Edit"})]})});function m(){i(!1)}};var S=function(){var e=Object(c.useContext)(d),t=Object(r.a)(e,2),n=t[0],a=t[1],s=Object(N.a)("userdata",(function(){return fetch("/api/profile").then((function(e){return e.json()}))}));return Object(c.useEffect)((function(){s.isSuccess&&a(Object(l.a)(Object(l.a)({},n),s.data.data))}),[]),Object(u.jsx)("main",{className:"profile",children:s.isLoading?Object(u.jsx)("div",{className:"loading",children:"It is loading..."}):s.isError?Object(u.jsx)("div",{className:"error",children:"There was an error fetching. Please log out and try again"}):Object(u.jsxs)(u.Fragment,{children:[Object(u.jsx)(C,{user:n,setUser:a}),Object(u.jsxs)("div",{className:"content",children:[Object(u.jsx)("h3",{className:"name",children:n.username}),Object(u.jsx)(y,{user:n,setUser:a})]})]})})};var w=function(){var e=Object(i.g)(),t=Object(c.useContext)(d),n=Object(r.a)(t,1)[0],a=Object(c.useState)(""),s=Object(r.a)(a,2),o=s[0],l=s[1],j=Object(c.useState)(""),b=Object(r.a)(j,2),h=b[0],m=b[1],O=Object(c.useState)(""),f=Object(r.a)(O,2),p=f[0],g=f[1],N=Object(c.useState)(""),v=Object(r.a)(N,2),C=v[0],y=v[1],S=Object(c.useState)(!1),w=Object(r.a)(S,2),T=w[0],k=w[1];return Object(c.useEffect)((function(){x(n,e)}),[]),Object(u.jsxs)("main",{className:"register-form",children:[Object(u.jsx)("h3",{className:"title",children:"Register"}),Object(u.jsxs)("form",{children:[Object(u.jsx)("input",{onChange:function(e){return m(e.target.value)},type:"text",className:"username ".concat("username"===o&&"error-primary"),placeholder:"Username",value:h}),Object(u.jsx)("input",{onChange:function(e){return g(e.target.value)},type:"password",className:"password ".concat("password"===o&&"error-primary"),placeholder:"Password",value:p}),Object(u.jsx)("input",{onChange:function(e){return y(e.target.value)},type:"email",className:"email ".concat("email"===o&&"error-primary"),placeholder:"Email",value:C}),Object(u.jsx)("button",{onClick:function(t){if(T)return;k(!0),t.preventDefault(),fetch("api/register",{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",body:JSON.stringify({username:h,password:p,email:C})}).then((function(e){return e.json()})).then((function(t){console.log(t),t.error?("username"===t.cause&&l("username"),"password"===t.cause&&l("password"),"email"===t.cause&&l("email")):e.replace("/login")})).catch((function(e){console.log(e),e&&console.log("No se pudo enviar la data...")})).finally((function(){return k(!1)}))},className:"register",children:"Register"})]})]})},T=n(20);var k=function(e){var t=e.ref,n=e.addChild,c=e.setCommentMode,a=e.setCommenting,s=e.answerContent,o=e.onChange;return Object(u.jsxs)(u.Fragment,{children:[Object(u.jsx)("input",{ref:t,value:s,type:"text",className:"answer-comment",onChange:o}),Object(u.jsx)("button",{onClick:n,className:"send-answer-comment",children:"Send"}),Object(u.jsx)("button",{onClick:function(){c(!1),a(!1)},className:"abort-answer-comment",children:"\xd7"})]})};var E=function(e){var t=e.ref,n=e.editComment,c=e.setEditMode,a=e.setCommenting,s=e.answerContent,o=e.onChange;return Object(u.jsxs)(u.Fragment,{children:[Object(u.jsx)("input",{ref:t,value:s,type:"text",className:"answer-comment",onChange:o}),Object(u.jsx)("button",{onClick:n,className:"send-answer-comment",children:Object(u.jsx)("i",{className:"fas fa-check yes"})}),Object(u.jsx)("button",{onClick:function(){c(!1),a(!1)},className:"abort-answer-comment",children:"\xd7"})]})};var P=function e(t){var n=t.source,a=Object(c.useState)(!1),s=Object(r.a)(a,2),j=s[0],b=s[1],h=Object(c.useState)(n.content),m=Object(r.a)(h,2),O=m[0],f=m[1],p=Object(c.useState)(!1),x=Object(r.a)(p,2),g=x[0],N=x[1],v=Object(c.useState)(!1),C=Object(r.a)(v,2),y=C[0],S=C[1],w=Object(c.useState)(""),P=Object(r.a)(w,2),F=P[0],U=P[1],A=Object(c.useContext)(d),J=Object(r.a)(A,1)[0],L=Object(c.useState)(JSON.parse(n.children)),R=Object(r.a)(L,2),I=R[0],D=R[1],_=n.commenting,q=n.setCommenting,M=Object(i.g)(),Q=Object(c.useRef)();return Object(c.useEffect)((function(){document.activeElement.blur(),Q.current&&Q.current.focus()}),[j]),Object(u.jsxs)("article",{className:"comment ".concat(n.id),children:[Object(u.jsx)(o.b,{className:"author",to:n.author===J.id?"/profile":"/users/".concat(n.author),children:n.authorName}),g?Object(u.jsx)(E,{editComment:function(e){q(!1),U(""),fetch("/api/comment/",{method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({content:F,id:n.id})}).then((function(e){return e.json()})).then((function(e){console.log(e),N(!1),f(F)})).catch((function(e){e&&console.log(e)}))},ref:Q,answerContent:F,setEditMode:N,setCommenting:q,onChange:function(e){return U(e.target.value)}}):Object(u.jsxs)(u.Fragment,{children:[Object(u.jsx)("p",{className:"content",children:O}),Object(u.jsxs)("ul",{className:"actions",children:[j?Object(u.jsx)(k,{addChild:function(e){b(!1),q(!1),U(""),fetch("/api/comment/",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({topic:n.topic,content:F,parent:n.id})}).then((function(e){return e.json()})).then((function(e){D([].concat(Object(T.a)(I),[Object(l.a)(Object(l.a)({},e.data),{},{authorName:J.username})])),y||Y()})).catch((function(e){e&&console.log(e)}))},ref:Q,answerContent:F,setCommentMode:b,setCommenting:q,onChange:function(e){return U(e.target.value)}}):Object(u.jsxs)(u.Fragment,{children:[!!I.length&&Object(u.jsx)("button",{onClick:Y,className:"see-more",children:"..."}),Object(u.jsx)("button",{onClick:function(){_||(J.logged||M.push("/login"),b(!0),q(!0))},className:"answer",children:"+"}),J.id===n.author&&Object(u.jsx)("button",{onClick:function(){_||(N(!0),q(!0))},className:"answer",children:Object(u.jsx)("i",{className:"fas fa-edit"})})]}),J.id===n.author&&Object(u.jsx)("button",{onClick:function(e){return t=n.id,n.setChildComments(n.childComments.filter((function(e){return e.id!==t}))),void fetch("/api/comment",{method:"DELETE",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({id:t})}).then((function(e){return e.json()})).then((function(e){return console.log(e)})).catch((function(e){e&&console.log(e)})).finally((function(){document.querySelector(".answer-comment")||q(!1)}));var t},className:"delete",children:Object(u.jsx)("i",{className:"fa fa-trash","aria-hidden":"true"})})]})]}),Object(u.jsx)("ol",{className:"children",children:!!I.length&&y&&I.map((function(t){return Object(u.jsx)(e,{source:Object(l.a)(Object(l.a)({},t),{},{childComments:I,setChildComments:D,commenting:_,setCommenting:q})},t.id+1e9)}))})]});function Y(){!1!==y?S(!1):fetch("/api/comment/".concat(n.id)).then((function(e){return e.json()})).then((function(e){return D(e)})).catch((function(e){return console.log(e)})).finally((function(){return S(!0)}))}};var F=function(e){var t=e.value,n=e.id,a=e.setEditMode,s=e.setIntro,o=Object(c.useState)(t),i=Object(r.a)(o,2),l=i[0],j=i[1];return Object(u.jsxs)(u.Fragment,{children:[Object(u.jsx)("textarea",{onChange:function(e){return j(e.target.value)},value:l}),Object(u.jsxs)("div",{className:"edit-actions",children:[Object(u.jsx)("button",{onClick:function(){fetch("/api/topics/",{method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({content:l,id:n})}).then((function(e){return e.json()})).then((function(){s(l),j(""),a(!1)})).catch((function(e){e&&console.log(e)}))},className:"confirm",children:"Yes"}),Object(u.jsx)("button",{onClick:function(){return a(!1)},className:"cancel",children:"No"})]})]})};var U=function(){var e=Object(i.h)().pathname,t=Object(c.useContext)(d),n=Object(r.a)(t,1)[0],a=Object(c.useState)(""),s=Object(r.a)(a,2),o=s[0],j=s[1],b=Object(c.useState)(""),h=Object(r.a)(b,2),m=h[0],O=h[1],f=Object(c.useState)(!1),p=Object(r.a)(f,2),x=p[0],g=p[1],N=Object(c.useState)(""),v=Object(r.a)(N,2),C=v[0],y=v[1],S=Object(i.g)(),w=Object(c.useState)([]),k=Object(r.a)(w,2),E=k[0],U=k[1],A=Object(c.useState)(!1),J=Object(r.a)(A,2),L=J[0],R=J[1],I=Object(c.useState)(""),D=Object(r.a)(I,2),_=D[0],q=D[1];return Object(c.useEffect)((function(){console.log("/api"+e),fetch("/api"+e).then((function(e){return e.json()})).then((function(e){var t=e.topic,n=e.comments;y(e.topic.intro),O(t),U(n),console.log(t)})).catch((function(e){e&&console.log(e)}))}),[]),Object(u.jsx)(u.Fragment,{children:m.subject&&m.intro?Object(u.jsxs)(u.Fragment,{children:[Object(u.jsxs)("main",{className:"topic",children:[Object(u.jsx)("h3",{className:"title",children:m.subject[0].toUpperCase()+m.subject.slice(1)}),x?Object(u.jsx)(F,{value:m.intro,id:m.id,editMode:x,setEditMode:g,setIntro:y}):Object(u.jsx)(u.Fragment,{children:Object(u.jsxs)("p",{className:"intro",children:[C,Object(u.jsx)("button",{onClick:function(){return g(!0)},className:"edit-topic",children:Object(u.jsx)("i",{className:"fas fa-edit"})})]})})]}),Object(u.jsxs)("article",{className:"actions",children:[Object(u.jsx)("input",{type:"text",className:"comment-content ".concat("main"===o&&"error-primary"),onChange:function(e){return q(e.target.value)},value:_}),Object(u.jsx)("button",{className:"add-comment",onClick:function(){n.logged||S.push("/login");if(!_.length)return void j("main");j(""),fetch("/api/comment",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({topic:m.id,parent:null,content:_})}).then((function(e){return e.json()})).then((function(e){q(""),U([].concat(Object(T.a)(E),[Object(l.a)(Object(l.a)({},e.data),{},{authorName:n.username})]))})).catch((function(e){return console.log(e)}))},children:"+"})]}),Object(u.jsx)("section",{className:"comments",children:E.map((function(e){return Object(u.jsx)(P,{source:Object(l.a)(Object(l.a)({},e),{},{childComments:E,setChildComments:U,commenting:L,setCommenting:R})},e.id+1e7)}))})]}):Object(u.jsx)("p",{children:"Loading..."})})};var A=function(){var e=Object(c.useContext)(d),t=Object(r.a)(e,1)[0],n=Object(N.a)("topics",(function(){return fetch("/api/topics").then((function(e){return e.json()}))}));return console.log(n),Object(u.jsxs)(u.Fragment,{children:[t.logged&&Object(u.jsx)("section",{className:"create-topic",children:Object(u.jsx)(o.b,{to:"/topics/create",className:"add-topic",children:"Add a new topic!"})}),Object(u.jsx)("main",{className:"topics",children:n.isLoading?Object(u.jsx)("div",{children:" Loading... "}):n.isError?Object(u.jsx)("div",{children:" There was an error, please refresh "}):Object(u.jsx)(u.Fragment,{children:n.data.data.map((function(e){return Object(u.jsxs)("article",{className:"topic ".concat(e.id),children:[Object(u.jsxs)(o.b,{to:"/topics/".concat(e.id),children:[Object(u.jsx)("div",{className:"rating",children:[1,2,3,4,5].map((function(t){return t<=e.rating?Object(u.jsx)("i",{className:"fas fa-star"},t):Object(u.jsx)("i",{className:"far fa-star"},t+100)}))}),Object(u.jsx)("h3",{className:"title",children:e.subject[0].toUpperCase()+e.subject.slice(1)}),Object(u.jsx)("p",{className:"content",children:e.intro}),Object(u.jsx)("h4",{className:"founder",children:e.authorName})]}),e.author===t.id&&Object(u.jsx)("button",{onClick:function(){return t=e.id,void fetch("/api/topics",{method:"DELETE",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({id:t})}).then((function(e){return e.json()})).then((function(e){console.log(e),K.refetchQueries("topics")})).catch((function(e){return console.log(e)}));var t},className:"delete",children:Object(u.jsx)("i",{className:"fa fa-trash","aria-hidden":"true"})})]},e.id)}))})})]})};var J=function(){var e=Object(c.useState)(""),t=Object(r.a)(e,2),n=t[0],a=t[1],s=Object(c.useState)(""),o=Object(r.a)(s,2),j=o[0],d=o[1],b=Object(i.g)();return Object(u.jsxs)("main",{className:"create-topic",children:[Object(u.jsx)("h3",{className:"title",children:"What topic would you like to create?"}),Object(u.jsxs)("form",{className:"topic-info",children:[Object(u.jsx)("input",{placeholder:"Topic's title",type:"text",className:"subject",value:n,onChange:function(e){return a(e.target.value)}}),Object(u.jsx)("textarea",{placeholder:"A small introduction...",className:"intro",value:j,onChange:function(e){return d(e.target.value)}}),Object(u.jsx)("button",{className:"create",onClick:function(e){if(e.preventDefault(),!n.length||!j.length)return;var t=(s=j,s.charAt(0).toUpperCase()+s.slice(1)),c={subject:n,intro:t};var s;fetch("/api/topics",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(Object(l.a)({},c))}).then((function(e){return e.json()})).then((function(e){console.log(e),d(""),a(""),b.push("/topics")})).catch((function(e){return console.log(e)}))},children:"Create!"})]})]})};var L=function(){var e=Object(c.useContext)(h),t=Object(r.a)(e,1)[0],n=Object(c.useContext)(d),a=Object(r.a)(n,1)[0],s=Object(N.a)(["searchedTopics",{search:t}],(function(e){var t=e.queryKey,n=Object(r.a)(t,2),c=(n[0],n[1].search);return fetch("/api/topics/search/".concat(c)).then((function(e){return e.json()}))}));return console.log(s),Object(u.jsx)("main",{className:"topics",children:s.isFetching?Object(u.jsx)("p",{children:"It is loading"}):s.isError?Object(u.jsx)("p",{children:"There was an error, please try another topic"}):s.data.data.length?Object(u.jsx)(u.Fragment,{children:s.data.data.map((function(e){return Object(u.jsxs)("article",{className:"topic ".concat(e.id),children:[Object(u.jsxs)(o.b,{to:"/topics/".concat(e.id),children:[Object(u.jsx)("div",{className:"rating",children:[1,2,3,4,5].map((function(t){return t<=e.rating?Object(u.jsx)("i",{className:"fas fa-star"},t):Object(u.jsx)("i",{className:"far fa-star"},t+100)}))}),Object(u.jsx)("h3",{className:"title",children:e.subject[0].toUpperCase()+e.subject.slice(1)}),Object(u.jsx)("p",{className:"content",children:e.intro}),Object(u.jsx)("h4",{className:"founder",children:e.authorName})]}),e.author===a.id&&Object(u.jsx)("button",{onClick:function(){return t=e.id,void fetch("/api/topics",{method:"DELETE",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({id:t})}).then((function(e){return e.json()})).then((function(e){console.log(e),K.refetchQueries("searchedTopics")})).catch((function(e){return console.log(e)}));var t},className:"delete",children:Object(u.jsx)("i",{className:"fa fa-trash","aria-hidden":"true"})})]},e.id)}))}):Object(u.jsxs)("section",{className:"no-matches",children:[Object(u.jsx)("p",{children:"There is no matching topic, sorry"}),Object(u.jsx)(o.b,{to:"/topics",children:"Go to Topics"})]})})};var R=function(){return Object(u.jsxs)(i.d,{children:[Object(u.jsx)(i.b,{exact:!0,path:"/topics",component:A}),Object(u.jsx)(i.b,{path:"/topics/create",component:J}),Object(u.jsx)(i.b,{exact:!0,path:"/topics/search/:search",component:L}),Object(u.jsx)(i.b,{exact:!0,path:"/topics/:id",component:U})]})};var I=function(){var e,t=Object(c.useContext)(d),n=Object(r.a)(t,1)[0],a=Object(N.a)("enemies",(function(){return fetch("/api/friends").then((function(e){return e.json()}))}),{enabled:!!n.id});return Object(u.jsxs)("main",{className:"enemies",children:[Object(u.jsx)("h2",{className:"title",children:"Your enemies"}),n.id?a.isFetching?Object(u.jsx)("div",{className:"loading",children:"It is loading..."}):a.isError?Object(u.jsx)("div",{className:"error",children:"There was an error, please refresh"}):!(null===(e=a.data)||void 0===e?void 0:e.data.length)&&n.id?Object(u.jsx)("article",{className:"no-friends",children:"There are no friends to show, man."}):a.data.data.map((function(e){return Object(u.jsxs)(o.b,{to:"/users/".concat(e.id),className:"friend",children:[Object(u.jsx)("img",{src:e.profile_image,alt:e.username,className:"avatar"}),Object(u.jsxs)("div",{className:"info",children:[Object(u.jsx)("h3",{className:"username",children:e.username}),Object(u.jsx)("p",{className:"info",children:e.profile_info})]})]},e.id)})):Object(u.jsxs)("article",{className:"no-friends",children:[Object(u.jsx)("p",{children:"You should login to see your friends"}),Object(u.jsx)(o.b,{to:"/login",className:"login",children:"Login"})]})]})};var D=function(){var e,t=Object(i.i)().params.id,n=Object(c.useContext)(d),a=Object(r.a)(n,1)[0],s=Object(i.g)(),o=Object(N.a)("anotheruser",(function(){return fetch("/api/users/"+t).then((function(e){return e.json()}))}),{cacheTime:0});return Object(u.jsx)("main",{className:"profile user",children:o.isLoading?Object(u.jsx)("div",{className:"loading",children:"It is loading..."}):o.isError?Object(u.jsx)("div",{className:"error",children:"There was an error fetching. Please log out and try again"}):!o.isFetching&&(null===(e=o.data)||void 0===e?void 0:e.data)?Object(u.jsxs)(u.Fragment,{children:[Object(u.jsx)("form",{children:Object(u.jsx)("div",{className:"avatar-section",children:Object(u.jsx)("img",{className:"image-picker",src:"/"+o.data.data.profile_image,alt:"Profile"})})}),Object(u.jsxs)("div",{className:"content",children:[Object(u.jsx)("h3",{className:"name",children:o.data.data.username}),Object(u.jsxs)("div",{className:"info",children:[Object(u.jsx)("p",{children:o.data.data.profile_info}),a.id&&JSON.parse(o.data.data.friends).includes(a.id)?Object(u.jsx)("button",{onClick:function(){return l(o.data.data.id)},className:"remove-friend",children:Object(u.jsx)("i",{className:"fas fa-user-times"})}):Object(u.jsx)("button",{onClick:function(){return l(o.data.data.id)},className:"add-friend",children:Object(u.jsx)("i",{className:"fas fa-user-plus"})})]})]})]}):Object(u.jsx)(u.Fragment,{})});function l(e){a.id||s.push("/login"),fetch("/api/friends",{method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({id:e})}).then((function(e){return e.json()})).then((function(e){console.log(e),K.refetchQueries("anotheruser")})).catch((function(e){return console.log(e)}))}};var _=function(e){var t=Object(c.useContext)(d),n=Object(r.a)(t,1)[0].logged,a=Object(i.h)();return Object(u.jsx)(u.Fragment,{children:n?Object(u.jsx)(i.b,Object(l.a)({},e)):Object(u.jsx)(i.a,{to:{pathname:"/login",state:{from:a}}})})};var q=function(e){var t=Object(c.useContext)(d),n=Object(r.a)(t,1)[0];console.log(n.logged?"Already logged":"Isnt logged yet");var a=n.logged;return Object(u.jsx)(u.Fragment,{children:a?Object(u.jsx)(i.a,{to:{pathname:"/"}}):Object(u.jsx)(i.b,Object(l.a)({},e))})};var M=function(){var e=Object(c.useState)(""),t=Object(r.a)(e,2),n=t[0],a=t[1],s=Object(c.useState)(!1),o=Object(r.a)(s,2),i=o[0],l=o[1],j=Object(c.useState)(!1),d=Object(r.a)(j,2),b=d[0],h=d[1];return Object(u.jsxs)("main",{className:"reset-form",children:[Object(u.jsx)("h3",{className:"title",children:"Reset Password"}),b?Object(u.jsx)("p",{className:"done",children:"The email has been sent. Go to check it out"}):Object(u.jsxs)("form",{children:[Object(u.jsx)("input",{onChange:function(e){return a(e.target.value)},value:n,type:"email",placeholder:"Email"}),Object(u.jsx)("button",{onClick:function(e){if(e.preventDefault(),i)return;l(!0),fetch("/api/users/reset",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({email:n})}).then((function(e){return e.json()})).then((function(e){console.log(e),e.error||h(!0)})).catch((function(e){return console.log(e)})).finally((function(){l(!1)}))},className:"reset",children:"Send Reset Request"})]}),i&&Object(u.jsx)("p",{className:"loading",children:"Is loading..."})]})};var Q=function(){var e=Object(c.useState)(""),t=Object(r.a)(e,2),n=t[0],a=t[1],s=Object(c.useState)(!1),l=Object(r.a)(s,2),j=l[0],d=l[1],b=Object(c.useState)(!1),h=Object(r.a)(b,2),m=h[0],O=h[1],f=Object(i.i)().params,p=new URLSearchParams(f.algo),x=p.get("resetKey"),g=p.get("id");return Object(u.jsxs)("main",{className:"reset-form",children:[Object(u.jsx)("h3",{className:"title",children:"Reset Password"}),m?Object(u.jsxs)(u.Fragment,{children:[Object(u.jsx)("p",{className:"done",children:"The password has been updated"}),Object(u.jsx)(o.b,{to:"/login",children:"Login"})]}):Object(u.jsxs)("form",{children:[Object(u.jsx)("input",{onChange:function(e){return a(e.target.value)},value:n,type:"password",placeholder:"Password"}),Object(u.jsx)("button",{onClick:function(e){if(e.preventDefault(),j)return;d(!0),fetch("/api/users/reset",{method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({password:n,resetKey:x,id:g})}).then((function(e){return e.json()})).then((function(e){console.log(e),e.error||O(!0)})).catch((function(e){return console.log(e)})).finally((function(){d(!1)}))},className:"reset-password",children:"Reset Password"})]}),j&&Object(u.jsx)("p",{className:"loading",children:"Is loading..."})]})};var Y=function(){return Object(u.jsxs)(i.d,{children:[Object(u.jsx)(i.b,{exact:!0,path:"/",component:p}),Object(u.jsx)(q,{path:"/login",component:g}),Object(u.jsx)(q,{path:"/register",component:w}),Object(u.jsx)(q,{path:"/reset/:algo",component:Q}),Object(u.jsx)(q,{exact:!0,path:"/reset",component:M}),Object(u.jsx)(_,{path:"/profile",component:S}),Object(u.jsx)(i.b,{path:"/topics",component:R}),Object(u.jsx)(i.b,{path:"/enemies",component:I}),Object(u.jsx)(i.b,{path:"/users/:id",component:D})]})},G=n(43),H=n(29),K=new G.a;var B=function(){return Object(u.jsx)(H.a,{client:K,children:Object(u.jsx)(o.a,{children:Object(u.jsx)(m,{children:Object(u.jsxs)(b,{children:[Object(u.jsx)(f,{}),Object(u.jsx)(Y,{})]})})})})};s.a.render(Object(u.jsx)(B,{}),document.getElementById("root"))}},[[41,1,2]]]);
//# sourceMappingURL=main.8c72678c.chunk.js.map